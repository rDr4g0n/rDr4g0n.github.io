{"version":3,"file":"app.js","sources":["utils.js","PortfolioItem.js","app.js"],"sourcesContent":["\"use strict\";\n\n// poor man's event delegation\n// TODO - upper limit on this recursion\nfunction delegate(el, selector, parent){\n    // walked all the way up or like, asplode\n    if(!el || el === parent){\n        return;\n    }\n\n    // fount it!\n    if(el.matches(selector)){\n        return el;\n    // lets walk up another level\n    } else {\n        return delegate(el.parentNode, selector, parent);\n    }\n}\n\nfunction addEventDelegateListener(el, eventName, selector, handler){\n    let fn = function(e){\n        let delegateTarget = delegate(e.target, selector, el);\n        if(delegateTarget){\n            handler(e, delegateTarget); \n        }\n    };\n    el.addEventListener(eventName, fn);\n    return function removeEventDelegateListener(){\n        el.removeEventListener(eventName, fn);\n    };\n}\n\nfunction pokeDOM(){\n    return document.body.offsetLeft;\n}\n\nfunction getScrollTop(){\n    return document.body.scrollTop || document.documentElement.scrollTop;\n}\n\nexport {\n    delegate,\n    addEventDelegateListener,\n    pokeDOM,\n    getScrollTop\n};\n","/* global baffle: true */\n\"use strict\";\n\nimport {pokeDOM} from \"utils\";\nlet baffleConfig = {characters: \" ░▒▓█</>\"};\n\nexport default class PortfolioItem {\n    constructor(navEl){\n        this.navEl = navEl;\n        this.id = navEl.hash.slice(1);\n        this.portfolioEl = document.getElementById(this.id);\n        this.cacheOffsetTop();\n\n        this.selected = false;\n\n        // make mouseover title trigger baffle effect\n        let titleEl = this.portfolioEl.querySelector(\".item-title\");\n        this.b = baffle(titleEl, baffleConfig);\n        titleEl.addEventListener(\"mouseover\", e => {\n            this.baffleTitle();\n        });\n\n        // NOTE - working around css transtions not working\n        // on elements with dimensions set by \"auto\"\n        this.navEl.classList.add(\"selected\");\n        pokeDOM();\n        this.navElExpandedWidth = window.getComputedStyle(this.navEl).width;\n        this.navEl.classList.remove(\"selected\");\n\n        // add explicit widths on hover to \n        // enable css transitions\n        this.navEl.addEventListener(\"mouseover\", e => {\n            this.navEl.style.width = this.navElExpandedWidth;\n        });\n        this.navEl.addEventListener(\"mouseout\", e => {\n            if(!this.selected){\n                this.navEl.style.removeProperty(\"width\");\n            }\n        });\n\n    }\n\n    // cache offsetTop to avoid expensive DOM lookups\n    cacheOffsetTop(){\n        this.offsetTop = this.portfolioEl.offsetTop;\n    }\n\n    // select nav el\n    select(skipBaffle){\n        if(!this.selected){\n            if(!skipBaffle){\n                this.baffleTitle();\n            }\n            this.selected = true;\n            this.navEl.classList.add(\"selected\");\n            this.navEl.style.width = this.navElExpandedWidth;\n        }\n    }\n\n    // deselect nav\n    deselect(){\n        if(this.selected){\n            this.selected = false;\n            this.navEl.classList.remove(\"selected\");\n            this.navEl.style.removeProperty(\"width\");\n        }\n    }\n\n    // apply baffle effect to portfolio item title\n    baffleTitle(){\n        // TODO - baffle seems to ignore numbers\n        // higher than 1000 here :/\n        this.b.reveal(1000);\n    }\n}\n","/* globals console: true, baffle: true, Blazy: true, Gifffer: true */\n\"use strict\";\n\nimport {addEventDelegateListener, pokeDOM, getScrollTop} from \"utils\";\nimport PortfolioItem from \"PortfolioItem\";\n\n// TODO - these should all be part of App\nlet bodyEl = document.body,\n    lastScrollPos = getScrollTop(),\n    scrollSensitivity = 70,\n    // TODO - should be a function of screen height\n    offsetPadding = 65,\n    width = window.outerWidth;\n\nconst MOBILE_BREAKPOINT = 500;\n\nclass App {\n\n    constructor(){\n        let navItemEls = document.querySelectorAll(\".nav-item\");\n        this.items = Array.prototype.map.call(navItemEls, el => new PortfolioItem(el));\n\n        // once the entire document has loaded, recalculate offsets\n        window.addEventListener(\"load\", e => {\n            this.refreshNavSelection();\n        });\n\n        // TODO - debounce\n        // on resize, recalculate offsets\n        window.addEventListener(\"resize\", e => {\n            this.refreshNavSelection();\n            // cache window width\n            width = window.outerWidth;\n        });\n\n        // as the page scrolls, select the appropriate nav el\n        window.addEventListener(\"scroll\", e => {\n            // dont bother updating nav if this is mobile-sized\n            if(this.isMobile()){\n                return;\n            }\n\n            if(Math.abs(getScrollTop() - lastScrollPos) > scrollSensitivity){\n                this.selectMostVisibleItem();\n            }\n        });\n\n        // lazy load images\n        new Blazy({\n            success: (el, msg) => {\n                // if its a gif, add a play button\n                if(el.matches(\".gifify\")){\n                    el.setAttribute(\"data-gifffer\", el.getAttribute(\"src\"));\n                    Gifffer();\n                }\n\n                // image size was just a placeholder, so kill it\n                el.style.width = \"unset\";\n                el.style.height = \"unset\";\n\n                // image load means portfolio offsets\n                // may have changed, so update em\n                app.refreshNavSelection();\n            }\n        });\n\n        // make all non-local links open in new tab\n        Array.prototype.forEach.call(document.querySelectorAll(\"a\"), el => {\n            if(!el.href.includes(document.location.origin)){\n                el.setAttribute(\"target\", \"_blank\");\n            }\n        });\n\n        // make nav clickies select the nav element\n        addEventDelegateListener(document.querySelector(\".main-nav\"), \"click\", \".nav-item\", (e, target) => {\n            this.getPortfolioItemForNavEl(target);\n        });\n\n        // figure out which portfolio item is visible and select it\n        this.refreshNavSelection();\n    }\n\n    // if this is mobile-device-sized, nav gets hidden\n    // so dont bother with all the expensive nav update stuff\n    isMobile(){\n        return width <= MOBILE_BREAKPOINT;\n    }\n\n    getPortfolioItemForNavEl(el){\n        for(let i = 0; i < this.items.length; i++){\n            if(this.items[i].navEl == el){\n                return this.items[i];\n            }\n        }\n    }\n\n    selectPortfolioItem(portfolioItem){\n        this.items.forEach(item => {\n            if(item === portfolioItem){\n                // select, but dont animate if \n                // mobile-sized\n                item.select(this.isMobile() ? true : false);\n            } else {\n                item.deselect();\n            }\n        });\n    }\n\n    // accessing offsetTop triggers a reflow, so cache\n    // it when possible\n    // TODO - debounce\n    updatePortfolioItemOffsets(){\n        this.items.forEach(item => item.cacheOffsetTop());\n    }\n\n    calculateMostVisiblePortfolioItem(){\n        lastScrollPos = getScrollTop();\n        let item, offsetTop;\n\n        // TODO - maybe rank items by most pixels in view?\n\n        // if near the end, select the last item\n        if(bodyEl.scrollHeight - lastScrollPos - bodyEl.clientHeight < scrollSensitivity){\n            //return this.items[this.items.length-1];\n            return;\n        }\n\n        // otherwise, figure out which item is nearest top\n        for(let i = this.items.length-1; i >= 0; i--){\n            item = this.items[i];\n            offsetTop = item.offsetTop - offsetPadding;\n\n            if(offsetTop < lastScrollPos){\n                return item;\n            }\n        }\n\n        // must be way up topsies, so select first\n        //return this.items[0];\n    }\n\n    selectMostVisibleItem(){\n        // see if selection should be updated\n        let mostVisible = this.calculateMostVisiblePortfolioItem();\n        if(mostVisible !== this.mostVisible){\n            this.mostVisible = mostVisible;\n            this.selectPortfolioItem(mostVisible);\n        }\n    }\n\n    refreshNavSelection(){\n        // dont even\n        if(this.isMobile()){\n            return;\n        }\n\n        // update offsets cache\n        this.updatePortfolioItemOffsets();\n        // make sure the right nav el is selected after\n        // calculating new offsets\n        this.selectMostVisibleItem();\n    }\n\n}\n\nlet app = new App();\n"],"names":[],"mappings":"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","sourceRoot":"/source/"}